前言

目前正是站的重整邏輯: 
1. PC版 (google / eage) 當目前到第二頁 重整的時候 點選取消 會停留
2. PC版 (google / eage) 當目前到第二頁 重整的時候 點選重整 會到第一頁
3. PC版 (google / eage) 重整顯示的文字是 是否重新提交表單 ， 而火狐的則是顯示必須重新傳送先前送過的資料才能顯示此網頁
4. PC版 (google / eage) 目前第一次重整後再去第二頁再次重整未顯示提示，但火狐卻可以再次顯示重整提示
5. M版 (google / safari) 當目前到第二頁 重整的時候 點選取消 會停留
6. M版 (google / safari) 當目前到第二頁 重整的時候 點選重整 會到第一頁
7. M版 (google) 重整顯示的文字是 確認重新提交表單 
8. M版 (safari) 重整顯示的文字是 確定要再次送出表單嗎? 取消 / 送出

總和以上的測試  可確定 重整文字上敘述無法保證在每個不同版本上 以及不同瀏覽器上 文字 都是一致的，並且無法保證沒一次重整都能顯示 重整提示 視窗


目前


當你使用 `window.addEventListener('beforeunload', ...)` 監控頁面「關閉、跳轉、重新整理」等事件時，這個事件確實很有用，但也有一些「限制」和「陷阱」。

---

## ✅ `beforeunload` 的優點（Pros）

1. **可以提示使用者：是否確定要離開頁面？**

   * 可用於防止「表單尚未送出」、「資料未儲存」時意外離開。
   * 可以彈出瀏覽器的系統提示視窗。

   ```js
   window.addEventListener('beforeunload', function (e) {
     e.preventDefault(); // 某些瀏覽器需要這行
     e.returnValue = ''; // 一定要設空字串才會有提示
   });
   ```

2. **可偵測頁面重整、關閉、跳轉等事件**

   * 非常實用於資料同步、清除暫存、紀錄使用者行為（如離開前打 API）。

3. **跨瀏覽器支援良好**

   * 幾乎所有現代瀏覽器都支援這個事件。

---

## ❌ `beforeunload` 的缺點與限制（Cons）

1. **提示訊息**無法自訂：

   * 瀏覽器不允許你改自訂訊息，會強制使用預設的警告文字。
   * 為防止釣魚/社交工程攻擊，這是出於安全考量。

2. **影響使用者體驗**：

   * 若用錯地方（如用於每次跳轉），會讓使用者每次操作都看到「是否離開」的訊息，體驗很差。

3. **有些瀏覽器可能忽略它**：

   * 某些環境（特別是手機瀏覽器或部分瀏覽器設定）可能完全不觸發 `beforeunload`。

4. **異步操作幾乎無效**：

   * 在 `beforeunload` 裡寫異步 API（像 `fetch()`、`setTimeout()`）**通常不會執行完成**。
   * 所以如果你想「上報離開行為」或「儲存資料」，必須用同步方式，或用 `navigator.sendBeacon()`。

   ```js
   navigator.sendBeacon('/log-exit', JSON.stringify({ action: 'user leaving' }));
   ```

